<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stepbit å®Œå…¨ç‰ˆ</title>
<style>
body { font-family:"Helvetica Neue", Arial, sans-serif; margin:20px; background:#fafafa;}
.card { background:#fff; padding:16px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
button { padding:8px 14px; border:none; border-radius:6px; cursor:pointer; }
button.primary { background:#FF6B6B; color:#fff; }
button.secondary { background:#ccc; color:#333; }
input, select, textarea { width:100%; padding:8px; margin:6px 0; border:1px solid #ccc; border-radius:6px; }
.chip { display:inline-block; padding:6px 10px; margin:4px; border:1px solid #ccc; border-radius:12px; cursor:pointer; }
.chip.selected { background:#FF6B6B; color:#fff; }
.hidden { display:none; }
.mood-btn { margin:4px; padding:8px 14px; border:1px solid #ccc; border-radius:6px; cursor:pointer; }
.mood-btn.active { background:#FF6B6B; color:#fff; }
.tabs { display:flex; margin-bottom:10px; }
.tab { flex:1; padding:8px; text-align:center; border-bottom:2px solid #ccc; cursor:pointer; }
.tab.active { border-bottom:3px solid #FF6B6B; font-weight:bold; color:#FF6B6B; }
#journalComment { padding:10px; border-radius:6px; height:100px; color:#fff; display:flex; align-items:center; justify-content:center; text-align:center; }
</style>
</head>
<body>

<!-- ğŸ§­ åˆæœŸè¨­å®š -->
<div id="onboarding" class="card">
  <h2>åˆæœŸãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</h2>
  <label>åå‰</label>
  <input id="name" placeholder="ä¾‹: å±±ç”° å¤ªéƒ">

  <label>æ€§åˆ¥</label>
  <select id="gender">
    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
    <option value="ç”·æ€§">ç”·æ€§</option>
    <option value="å¥³æ€§">å¥³æ€§</option>
    <option value="ãã®ä»–">ãã®ä»–</option>
  </select>

  <label>å¹´é½¢</label>
  <input id="age" type="number" min="0" placeholder="ä¾‹: 25">

  <label>æ€§æ ¼ã‚¿ã‚¤ãƒ—</label>
  <div class="chips">
    <span class="chip" data-val="è¿½ã„è¾¼ã¿å‹">è¿½ã„è¾¼ã¿å‹</span>
    <span class="chip" data-val="è¨ˆç”»å‹">è¨ˆç”»å‹</span>
    <span class="chip" data-val="ãƒã‚¤ãƒšãƒ¼ã‚¹å‹">ãƒã‚¤ãƒšãƒ¼ã‚¹å‹</span>
  </div>

  <label>ç›®æ¨™</label>
  <input id="goalTitle" placeholder="ä¾‹: è‹±ä¼šè©±ãƒ»ç­‹ãƒˆãƒ¬ãƒ»èª­æ›¸ãªã©">

  <button id="saveOnboard" class="primary">ä¿å­˜ã—ã¦æ¬¡ã¸</button>
</div>

<!-- ğŸ˜Œ ä»Šæ—¥ã®æ°—åˆ† -->
<div id="moodSelect" class="card hidden">
  <h2>ä»Šæ—¥ã®æ°—åˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
  <div id="moodBtns">
    <button class="mood-btn" data-level="5">å…ƒæ°— ğŸ’ª</button>
    <button class="mood-btn" data-level="4">ã‚„ã‚„å…ƒæ°— ğŸ™‚</button>
    <button class="mood-btn" data-level="3">æ™®é€š ğŸ˜</button>
    <button class="mood-btn" data-level="2">å°‘ã—ç–²ã‚ŒãŸ ğŸ˜´</button>
    <button class="mood-btn" data-level="1">ä»Šæ—¥ã¯ä¼‘ã‚€ ğŸ’¤</button>
  </div>
  <button id="confirmMood" class="primary">ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’è¦‹ã‚‹</button>
</div>

<!-- ğŸ’¡ ä»Šæ—¥ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ -->
<div id="challenge" class="card hidden">
  <h2>ä»Šæ—¥ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h2>
  <p id="challengeText"></p>
  <button class="secondary" id="btnDid">ã‚„ã£ãŸ âœ…</button>
  <button class="secondary" id="btnHalf">ã‚„ã‚„ã§ããŸ âš¡</button>
  <button class="secondary" id="btnFail">ã§ããªã‹ã£ãŸ âŒ</button>
</div>

<!-- âœï¸ ã‚¸ãƒ£ãƒ¼ãƒŠãƒ« -->
<div id="journal" class="card hidden">
  <h2>ä»Šæ—¥ã®ä¸€æ­©ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«</h2>
  <div style="display:flex; gap:10px;">
    <textarea id="journalText" rows="4" placeholder="ä»Šæ—¥ã®æ„Ÿæƒ³ãƒ»æ°—ã¥ãã‚’æ›¸ãã¾ã—ã‚‡ã†" style="flex:1;"></textarea>
    <div id="journalComment" style="flex:0 0 200px; border:1px solid #ccc;"></div>
  </div>
  <button id="saveJournal" class="primary">ä¿å­˜</button>
</div>

<!-- ğŸ‘¤ ãƒã‚¤ãƒšãƒ¼ã‚¸ -->
<div id="mypage" class="card hidden">
  <div class="tabs">
    <div class="tab active" id="tabProfile">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</div>
    <div class="tab" id="tabProgress">é”æˆçŠ¶æ³</div>
    <div class="tab" id="tabJournal">ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«å±¥æ­´</div>
  </div>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ± -->
  <div id="profileSection">
    <h3>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</h3>
    <div id="profileInfo"></div>
    <button id="resetProfile" class="secondary">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <!-- é”æˆçŠ¶æ³ -->
  <div id="progressSection" class="hidden">
    <h3>é”æˆçŠ¶æ³</h3>
    <ul id="historyList"></ul>
  </div>

  <!-- ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«å±¥æ­´ -->
  <div id="journalSection" class="hidden">
    <h3>éå»ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«</h3>
    <ul id="journalList"></ul>
  </div>
</div>

<script>
let selectedMood = null;
let selectedAchieve = null;

// ğŸ§© ãƒãƒƒãƒ—é¸æŠ
document.querySelectorAll('.chip').forEach(c=>{
  c.addEventListener('click', ()=>{
    document.querySelectorAll('.chip').forEach(x=>x.classList.remove('selected'));
    c.classList.add('selected');
  });
});

// ğŸ§© ä¿å­˜ãƒœã‚¿ãƒ³ï¼ˆåˆæœŸè¨­å®šï¼‰
document.getElementById('saveOnboard').addEventListener('click',()=>{
  const profile = {
    name: document.getElementById('name').value,
    gender: document.getElementById('gender').value,
    age: document.getElementById('age').value,
    personality: Array.from(document.querySelectorAll('.chip.selected')).map(c=>c.dataset.val)[0] || "",
    goal: document.getElementById('goalTitle').value
  };
  if(!profile.name || !profile.goal){ alert("åå‰ã¨ç›®æ¨™ã¯å¿…é ˆã§ã™"); return; }
  localStorage.setItem('stepbit_profile', JSON.stringify(profile));
  document.getElementById('onboarding').classList.add('hidden');
  document.getElementById('moodSelect').classList.remove('hidden');
});

// ğŸ˜Œ æ°—åˆ†é¸æŠ
document.querySelectorAll('.mood-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    selectedMood = parseInt(btn.dataset.level);
  });
});

document.getElementById('confirmMood').addEventListener('click',()=>{
  if(!selectedMood){ alert("æ°—åˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„"); return; }
  document.getElementById('challengeText').textContent = suggestChallenge();
  document.getElementById('moodSelect').classList.add('hidden');
  document.getElementById('challenge').classList.remove('hidden');
});

// ğŸ’¡ ãƒãƒ£ãƒ¬ãƒ³ã‚¸ææ¡ˆ
function suggestChallenge(){
  const p = JSON.parse(localStorage.getItem('stepbit_profile'));
  const goal = p.goal || "ç›®æ¨™";
  const type = p.personality || "ãƒã‚¤ãƒšãƒ¼ã‚¹å‹";

  if(selectedMood <= 2) return `ä»Šæ—¥ã¯ä¼‘æ¯æ—¥ã€‚${goal}ã®ã“ã¨ã‚’è€ƒãˆã‚‹æ™‚é–“ã«ã—ã‚ˆã†ã€‚`;
  if(goal.includes("è‹±ä¼šè©±")){
    if(type==="è¿½ã„è¾¼ã¿å‹" && selectedMood>=4) return "è‹±ä¼šè©±ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’10å€‹ç·´ç¿’ã—ã¦ã¿ã‚ˆã†ï¼";
    if(type==="è¨ˆç”»å‹") return "è‹±ä¼šè©±ã‚¢ãƒ—ãƒªã§5åˆ†ãƒªã‚¹ãƒ‹ãƒ³ã‚°ç·´ç¿’ã€‚";
    return "è‹±èªæ—¥è¨˜ã‚’1æ–‡ã ã‘æ›¸ã„ã¦ã¿ã‚ˆã†ï¼";
  }
  if(goal.includes("ç­‹ãƒˆãƒ¬")){
    if(selectedMood>=4) return "è…•ç«‹ã¦20å›ãƒ»ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ30å›ã«æŒ‘æˆ¦ï¼";
    if(selectedMood===3) return "ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‹è»½ã„ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ5å›ï¼";
    return "æ·±å‘¼å¸ã—ã¦ä½“ã‚’ä¼‘ã‚ã‚ˆã†ã€‚";
  }
  if(goal.includes("èª­æ›¸")){
    if(selectedMood>=4) return "æœ¬ã‚’10ãƒšãƒ¼ã‚¸èª­ã‚“ã§è¦ç´„ã—ã¦ã¿ã‚ˆã†ã€‚";
    return "1ãƒšãƒ¼ã‚¸ã§ã‚‚OKï¼ç¶™ç¶šãŒå¤§äº‹ğŸ“–";
  }
  return `${goal}ã«å‘ã‘ã¦ã€å°‘ã—ã§ã‚‚å‰é€²ã—ã¦ã¿ã‚ˆã†ï¼`;
}

// ğŸ’ª ãƒãƒ£ãƒ¬ãƒ³ã‚¸çµæœ
["btnDid","btnHalf","btnFail"].forEach(id=>{
  document.getElementById(id).addEventListener('click',()=>{
    if(id==="btnDid") selectedAchieve="ã‚„ã£ãŸ";
    if(id==="btnHalf") selectedAchieve="ã‚„ã‚„ã§ããŸ";
    if(id==="btnFail") selectedAchieve="ã§ããªã‹ã£ãŸ";

    const comment = document.getElementById('journalComment');
    if(selectedAchieve==="ã‚„ã£ãŸ"){ comment.textContent="æœ€é«˜ï¼ã‚ˆãé ‘å¼µã£ãŸã­ğŸ‰"; comment.style.background="#28a745"; }
    else if(selectedAchieve==="ã‚„ã‚„ã§ããŸ"){ comment.textContent="ãƒŠã‚¤ã‚¹ãƒãƒ£ãƒ¬ãƒ³ã‚¸âœ¨"; comment.style.background="#ffc107"; comment.style.color="#000"; }
    else{ comment.textContent="å¤§ä¸ˆå¤«ï¼æ˜æ—¥ã¾ãŸä¸€æ­©ğŸ’ª"; comment.style.background="#dc3545"; }

    document.getElementById('challenge').classList.add('hidden');
    document.getElementById('journal').classList.remove('hidden');
  });
});

// âœï¸ ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ä¿å­˜ â†’ ãƒã‚¤ãƒšãƒ¼ã‚¸ã¸
document.getElementById('saveJournal').addEventListener('click',()=>{
  const history = JSON.parse(localStorage.getItem('stepbit_history')||'[]');
  const entry = {
    date: new Date().toLocaleString(),
    mood: selectedMood,
    achieve: selectedAchieve,
    text: document.getElementById('journalText').value
  };
  history.push(entry);
  localStorage.setItem('stepbit_history', JSON.stringify(history));
  document.getElementById('journal').classList.add('hidden');
  showMyPage();
});

// ğŸ‘¤ ãƒã‚¤ãƒšãƒ¼ã‚¸è¡¨ç¤º
function showMyPage(){
  const data = JSON.parse(localStorage.getItem('stepbit_profile'));
  const history = JSON.parse(localStorage.getItem('stepbit_history')||'[]');

  document.getElementById('profileInfo').innerHTML = `
    <p><strong>åå‰ï¼š</strong>${data.name}</p>
    <p><strong>æ€§åˆ¥ï¼š</strong>${data.gender||"æœªè¨­å®š"}</p>
    <p><strong>å¹´é½¢ï¼š</strong>${data.age||"æœªè¨­å®š"}</p>
    <p><strong>æ€§æ ¼ã‚¿ã‚¤ãƒ—ï¼š</strong>${data.personality||"æœªè¨­å®š"}</p>
    <p><strong>ç›®æ¨™ï¼š</strong>${data.goal}</p>
  `;
  document.getElementById('historyList').innerHTML = history.length===0 ? "<li>ã¾ã å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>" :
    history.map(h=>`<li>${h.date}ï½œ${h.achieve}</li>`).join("");

  document.getElementById('journalList').innerHTML = history.length===0 ? "<li>ã¾ã ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>" :
    history.map(h=>`<li><strong>${h.date}</strong><br>æ°—åˆ†:${h.mood}ï½œçµæœ:${h.achieve}<br>${h.text}</li>`).join("");

  document.getElementById('mypage').classList.remove('hidden');
}

// ğŸ” ãƒªã‚»ãƒƒãƒˆ
document.getElementById('resetProfile').addEventListener('click',()=>{
  if(confirm("ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ")){
    localStorage.clear();
    document.getElementById('mypage').classList.add('hidden');
    document.getElementById('onboarding').classList.remove('hidden');
  }
});

// ğŸ—‚ï¸ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
const tabs = ["Profile","Progress","Journal"];
tabs.forEach(t=>{
  document.getElementById("tab"+t).addEventListener('click',()=>{
    tabs.forEach(x=>{
      document.getElementById("tab"+x).classList.remove('active');
      document.getElementById(x.toLowerCase()+"Section").classList.add('hidden');
    });
    document.getElementById("tab"+t).classList.add('active');
    document.getElementById(t.toLowerCase()+"Section").classList.remove('hidden');
  });
});

// ğŸš€ èµ·å‹•æ™‚
window.onload = ()=>{
  if(localStorage.getItem('stepbit_profile')){
    document.getElementById('onboarding').classList.add('hidden');
    document.getElementById('moodSelect').classList.remove('hidden');
  }
};
</script>
</body>
</html>
