<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stepbit æˆé•·ç‰ˆ</title>
<style>
body { font-family:"Helvetica Neue", Arial, sans-serif; margin:20px; background:#fafafa;}
.card { background:#fff; padding:16px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
button { padding:8px 14px; border:none; border-radius:6px; cursor:pointer; }
button.primary { background:#FF6B6B; color:#fff; }
button.secondary { background:#ccc; color:#333; }
input, select, textarea { width:100%; padding:8px; margin:6px 0; border:1px solid #ccc; border-radius:6px; }
.chip { display:inline-block; padding:6px 10px; margin:4px; border:1px solid #ccc; border-radius:12px; cursor:pointer; }
.chip.selected { background:#FF6B6B; color:#fff; }
.hidden { display:none; }
.mood-btn { margin:4px; padding:8px 14px; border:1px solid #ccc; border-radius:6px; cursor:pointer; }
.mood-btn.active { background:#FF6B6B; color:#fff; }
.tabs { display:flex; margin-bottom:10px; }
.tab { flex:1; padding:8px; text-align:center; border-bottom:2px solid #ccc; cursor:pointer; }
.tab.active { border-bottom:3px solid #FF6B6B; font-weight:bold; color:#FF6B6B; }
#journalComment { padding:10px; border-radius:6px; height:100px; color:#fff; display:flex; align-items:center; justify-content:center; text-align:center; }
.progress-bar { width:100%; height:20px; background:#eee; border-radius:10px; margin-top:10px; overflow:hidden; }
.progress-fill { height:100%; background:#FF6B6B; width:0%; border-radius:10px; transition:width 0.5s ease; }
.tree { text-align:center; font-size:48px; transition:transform 0.3s ease; transform-origin: bottom center; margin-top:10px; display:inline-block; }
.level-text { text-align:center; font-weight:bold; margin-top:6px; }
.streak { text-align:center; margin-top:8px; font-size:14px; color:#555; }
</style>
</head>
<body>

<!-- ğŸ§­ åˆæœŸè¨­å®š -->
<div id="onboarding" class="card">
  <h2>åˆæœŸãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</h2>
  <label>åå‰</label>
  <input id="name" placeholder="ä¾‹: å±±ç”° å¤ªéƒ">
  <label>æ€§åˆ¥</label>
  <select id="gender">
    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
    <option value="ç”·æ€§">ç”·æ€§</option>
    <option value="å¥³æ€§">å¥³æ€§</option>
    <option value="ãã®ä»–">ãã®ä»–</option>
  </select>
  <label>å¹´é½¢</label>
  <input id="age" type="number" min="0" placeholder="ä¾‹: 25">
  <label>æ€§æ ¼ã‚¿ã‚¤ãƒ—</label>
  <div class="chips">
    <span class="chip" data-val="è¿½ã„è¾¼ã¿å‹">è¿½ã„è¾¼ã¿å‹</span>
    <span class="chip" data-val="è¨ˆç”»å‹">è¨ˆç”»å‹</span>
    <span class="chip" data-val="ãƒã‚¤ãƒšãƒ¼ã‚¹å‹">ãƒã‚¤ãƒšãƒ¼ã‚¹å‹</span>
  </div>
  <label>ç›®æ¨™</label>
  <input id="goalTitle" placeholder="ä¾‹: è‹±ä¼šè©±ãƒ»ç­‹ãƒˆãƒ¬ãƒ»èª­æ›¸ãªã©">
  <button id="saveOnboard" class="primary">ä¿å­˜ã—ã¦æ¬¡ã¸</button>
</div>

<!-- ğŸ˜Œ ä»Šæ—¥ã®æ°—åˆ† -->
<div id="moodSelect" class="card hidden">
  <h2>ä»Šæ—¥ã®æ°—åˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
  <div id="moodBtns">
    <button class="mood-btn" data-level="5">å…ƒæ°— ğŸ’ª</button>
    <button class="mood-btn" data-level="4">ã‚„ã‚„å…ƒæ°— ğŸ™‚</button>
    <button class="mood-btn" data-level="3">æ™®é€š ğŸ˜</button>
    <button class="mood-btn" data-level="2">å°‘ã—ç–²ã‚ŒãŸ ğŸ˜´</button>
    <button class="mood-btn" data-level="1">ä»Šæ—¥ã¯ä¼‘ã‚€ ğŸ’¤</button>
  </div>
  <button id="confirmMood" class="primary">ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’è¦‹ã‚‹</button>
</div>

<!-- ğŸ’¡ ä»Šæ—¥ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ -->
<div id="challenge" class="card hidden">
  <h2>ä»Šæ—¥ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h2>
  <p id="challengeText"></p>
  <button class="secondary" id="btnDid">ã‚„ã£ãŸ âœ…</button>
  <button class="secondary" id="btnHalf">ã‚„ã‚„ã§ããŸ âš¡</button>
  <button class="secondary" id="btnFail">ã§ããªã‹ã£ãŸ âŒ</button>
</div>

<!-- âœï¸ ã‚¸ãƒ£ãƒ¼ãƒŠãƒ« -->
<div id="journal" class="card hidden">
  <h2>ä»Šæ—¥ã®ä¸€æ­©ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«</h2>
  <div style="display:flex; gap:10px;">
    <textarea id="journalText" rows="4" placeholder="ä»Šæ—¥ã®æ„Ÿæƒ³ãƒ»æ°—ã¥ãã‚’æ›¸ãã¾ã—ã‚‡ã†" style="flex:1;"></textarea>
    <div id="journalComment" style="flex:0 0 200px; border:1px solid #ccc;"></div>
  </div>
  <button id="saveJournal" class="primary">ä¿å­˜</button>
</div>

<!-- ğŸ‘¤ ãƒã‚¤ãƒšãƒ¼ã‚¸ -->
<div id="mypage" class="card hidden">
  <div class="tabs">
    <div class="tab active" id="tabProfile">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</div>
    <div class="tab" id="tabProgress">é”æˆçŠ¶æ³</div>
    <div class="tab" id="tabJournal">ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«å±¥æ­´</div>
  </div>

  <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ± -->
  <div id="profileSection">
    <h3>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</h3>
    <div id="profileInfo"></div>
    <button id="resetProfile" class="secondary" style="margin-top:10px;">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªã‚»ãƒƒãƒˆ</button>
  </div>

  <!-- é”æˆçŠ¶æ³ -->
  <div id="progressSection" class="hidden">
    <h3>æˆé•·ã®è¨˜éŒ² ğŸŒ³</h3>
    <div class="level-text" id="levelText"></div>
    <div class="streak" id="streakDays">ç¶™ç¶šæ—¥æ•°ï¼š0æ—¥</div>
    <div style="text-align:center; margin-top:10px;">
      <div class="tree" id="tree">ğŸŒ±</div>
    </div>
    <div class="progress-bar" style="margin-top:10px;">
      <div class="progress-fill" id="progressFill"></div>
    </div>
  </div>

  <!-- ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«å±¥æ­´ -->
  <div id="journalSection" class="hidden">
    <h3>éå»ã®ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«</h3>
    <ul id="journalList"></ul>
  </div>
</div>

<script>
let selectedMood=null, selectedAchieve=null;
const POINTS={ "ã‚„ã£ãŸ":3, "ã‚„ã‚„ã§ããŸ":2, "ã§ããªã‹ã£ãŸ":0 };

// âœ… æ€§æ ¼ãƒãƒƒãƒ—
document.querySelectorAll('.chip').forEach(c=>{
  c.addEventListener('click',()=>{
    document.querySelectorAll('.chip').forEach(x=>x.classList.remove('selected'));
    c.classList.add('selected');
  });
});

// âœ… åˆæœŸè¨­å®šä¿å­˜
document.getElementById('saveOnboard').addEventListener('click',()=>{
  const profile={
    name:document.getElementById('name').value,
    gender:document.getElementById('gender').value,
    age:document.getElementById('age').value,
    personality:Array.from(document.querySelectorAll('.chip.selected')).map(c=>c.dataset.val)[0]||"",
    goal:document.getElementById('goalTitle').value
  };
  if(!profile.name||!profile.goal){alert("åå‰ã¨ç›®æ¨™ã¯å¿…é ˆã§ã™");return;}
  localStorage.setItem('stepbit_profile',JSON.stringify(profile));
  localStorage.setItem('stepbit_level',JSON.stringify({level:1,exp:0}));
  localStorage.setItem('stepbit_streak',JSON.stringify({lastDate:null,days:0}));
  document.getElementById('onboarding').classList.add('hidden');
  document.getElementById('moodSelect').classList.remove('hidden');
});

// âœ… æ°—åˆ†é¸æŠ
document.querySelectorAll('.mood-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    selectedMood=parseInt(btn.dataset.level);
  });
});
document.getElementById('confirmMood').addEventListener('click',()=>{
  if(!selectedMood){alert("æ°—åˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„");return;}
  document.getElementById('challengeText').textContent=suggestChallenge();
  document.getElementById('moodSelect').classList.add('hidden');
  document.getElementById('challenge').classList.remove('hidden');
});

// âœ… ãƒãƒ£ãƒ¬ãƒ³ã‚¸ææ¡ˆ
function suggestChallenge(){
  const p=JSON.parse(localStorage.getItem('stepbit_profile'));
  const goal=p.goal||"ç›®æ¨™";const type=p.personality||"ãƒã‚¤ãƒšãƒ¼ã‚¹å‹";
  if(selectedMood<=2)return`ä»Šæ—¥ã¯ä¼‘æ¯æ—¥ã€‚${goal}ã®ã“ã¨ã‚’è€ƒãˆã‚‹æ—¥ã«ã—ã‚ˆã†ã€‚`;
  if(goal.includes("è‹±ä¼šè©±")){
    if(type==="è¿½ã„è¾¼ã¿å‹"&&selectedMood>=4)return"è‹±ä¼šè©±ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’10å€‹ç·´ç¿’ã—ã¦ã¿ã‚ˆã†ï¼";
    if(type==="è¨ˆç”»å‹")return"è‹±ä¼šè©±ã‚¢ãƒ—ãƒªã§5åˆ†ãƒªã‚¹ãƒ‹ãƒ³ã‚°ç·´ç¿’ã€‚";
    return"è‹±èªæ—¥è¨˜ã‚’1æ–‡ã ã‘æ›¸ã„ã¦ã¿ã‚ˆã†ï¼";
  }
  if(goal.includes("ç­‹ãƒˆãƒ¬")){
    if(selectedMood>=4)return"è…•ç«‹ã¦20å›ãƒ»ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ30å›ã«æŒ‘æˆ¦ï¼";
    if(selectedMood===3)return"ã‚¹ãƒˆãƒ¬ãƒƒãƒï¼‹è»½ã„ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ5å›ï¼";
    return"æ·±å‘¼å¸ã—ã¦ä½“ã‚’ä¼‘ã‚ã‚ˆã†ã€‚";
  }
  if(goal.includes("èª­æ›¸")){
    if(selectedMood>=4)return"æœ¬ã‚’10ãƒšãƒ¼ã‚¸èª­ã‚‚ã†ï¼";
    return"1ãƒšãƒ¼ã‚¸ã§ã‚‚OKï¼ç¶™ç¶šãŒåŠ›ğŸ“–";
  }
  return`${goal}ã«å‘ã‘ã¦ä¸€æ­©é€²ã‚‚ã†ï¼`;
}

// âœ… ãƒãƒ£ãƒ¬ãƒ³ã‚¸çµæœ
["btnDid","btnHalf","btnFail"].forEach(id=>{
  document.getElementById(id).addEventListener('click',()=>{
    if(id==="btnDid")selectedAchieve="ã‚„ã£ãŸ";
    if(id==="btnHalf")selectedAchieve="ã‚„ã‚„ã§ããŸ";
    if(id==="btnFail")selectedAchieve="ã§ããªã‹ã£ãŸ";
    const comment=document.getElementById('journalComment');
    if(selectedAchieve==="ã‚„ã£ãŸ"){comment.textContent="æœ€é«˜ï¼ã‚ˆãé ‘å¼µã£ãŸğŸ‰";comment.style.background="#28a745";}
    else if(selectedAchieve==="ã‚„ã‚„ã§ããŸ"){comment.textContent="ãƒŠã‚¤ã‚¹ãƒãƒ£ãƒ¬ãƒ³ã‚¸âœ¨";comment.style.background="#ffc107";comment.style.color="#000";}
    else{comment.textContent="å¤§ä¸ˆå¤«ï¼æ˜æ—¥ã¾ãŸä¸€æ­©ğŸ’ª";comment.style.background="#dc3545";}
    document.getElementById('challenge').classList.add('hidden');
    document.getElementById('journal').classList.remove('hidden');
  });
});

// âœ… ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ä¿å­˜
document.getElementById('saveJournal').addEventListener('click',()=>{
  const history=JSON.parse(localStorage.getItem('stepbit_history')||'[]');
  const entry={date:new Date().toLocaleDateString(),achieve:selectedAchieve,text:document.getElementById('journalText').value};
  history.push(entry);
  localStorage.setItem('stepbit_history',JSON.stringify(history));

  updateProgress(POINTS[selectedAchieve]);
  document.getElementById('journal').classList.add('hidden');
  showMyPage();
});

// âœ… æˆé•·å€¤æ›´æ–° & ç¶™ç¶šæ—¥æ•°æ›´æ–°ï¼ˆãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—é€šçŸ¥è¿½åŠ ï¼‰
function updateProgress(points){
  let lv = JSON.parse(localStorage.getItem('stepbit_level')) || {level:1, exp:0};
  lv.exp += points;
  let leveledUp = false;
  if(lv.exp >= 10){
    lv.level++;
    lv.exp -= 10;
    leveledUp = true;
  }
  localStorage.setItem('stepbit_level', JSON.stringify(lv));

  const streak = calculateStreak(selectedAchieve);
  localStorage.setItem('stepbit_streak', JSON.stringify(streak));

  if(leveledUp){
    animateTree(lv.level);
    showLevelUpNotification(lv.level);
  }
}

// âœ… ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—é€šçŸ¥
function showLevelUpNotification(level){
  // ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥
  if("Notification" in window){
    if(Notification.permission === "granted"){
      new Notification(`ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼`, { body: `ãŠã‚ã§ã¨ã†ï¼Lv.${level}ã«ãªã‚Šã¾ã—ãŸğŸ‰` });
    } else if(Notification.permission !== "denied"){
      Notification.requestPermission().then(permission => {
        if(permission === "granted"){
          new Notification(`ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼`, { body: `ãŠã‚ã§ã¨ã†ï¼Lv.${level}ã«ãªã‚Šã¾ã—ãŸğŸ‰` });
        }
      });
    }
  }
  // ç”»é¢å†…ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
  const popup = document.createElement('div');
  popup.textContent = `ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼Lv.${level} ğŸ‰`;
  popup.style.position = 'fixed';
  popup.style.top = '20px';
  popup.style.left = '50%';
  popup.style.transform = 'translateX(-50%)';
  popup.style.background = '#FF6B6B';
  popup.style.color = '#fff';
  popup.style.padding = '12px 20px';
  popup.style.borderRadius = '8px';
  popup.style.boxShadow = '0 2px 6px rgba(0,0,0,0.3)';
  popup.style.zIndex = 9999;
  document.body.appendChild(popup);
  setTimeout(()=> popup.remove(), 3000);
}

// âœ… æœ¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
function animateTree(level){
  const tree=document.getElementById('tree');
  const baseScale=1;
  const newScale=baseScale + level*0.05; 
  tree.style.transform='scaleY('+(newScale*1.5)+')';
  setTimeout(()=>{tree.style.transform='scaleY('+newScale+')';},500);
}

// âœ… ç¶™ç¶šæ—¥æ•°è¨ˆç®—
function calculateStreak(result){
  let s=JSON.parse(localStorage.getItem('stepbit_streak'))||{lastDate:null,days:0};
  const today=new Date().toLocaleDateString();
  if(result==="ã§ããªã‹ã£ãŸ") return s;
  if(s.lastDate===today) return s;
  const yesterday=new Date(Date.now()-86400000).toLocaleDateString();
  s.days=(s.lastDate===yesterday)?s.days+1:1;
  s.lastDate=today;
  return s;
}

// âœ… ãƒã‚¤ãƒšãƒ¼ã‚¸è¡¨ç¤º
function showMyPage(){
  const data=JSON.parse(localStorage.getItem('stepbit_profile'));
  const lv=JSON.parse(localStorage.getItem('stepbit_level'))||{level:1,exp:0};
  const streak=JSON.parse(localStorage.getItem('stepbit_streak'))||{days:0};
  const history=JSON.parse(localStorage.getItem('stepbit_history')||'[]');

  document.getElementById('profileInfo').innerHTML=`
    <p><strong>åå‰ï¼š</strong>${data.name}</p>
    <p><strong>æ€§åˆ¥ï¼š</strong>${data.gender||"æœªè¨­å®š"}</p>
    <p><strong>å¹´é½¢ï¼š</strong>${data.age||"æœªè¨­å®š"}</p>
    <p><strong>æ€§æ ¼ã‚¿ã‚¤ãƒ—ï¼š</strong>${data.personality||"æœªè¨­å®š"}</p>
    <p><strong>ç›®æ¨™ï¼š</strong>${data.goal}</p>`;

  const fill=document.getElementById('progressFill');
  fill.style.width=(lv.exp*10)+"%";
  document.getElementById('levelText').textContent=`Lv.${lv.level}`;
  const tree=document.getElementById('tree');
  const baseScale=1;
  tree.style.transform='scaleY('+(baseScale+lv.level*0.05)+')';
  const trees=["ğŸŒ±","ğŸŒ¿","ğŸŒ³","ğŸŒ²","ğŸŒ´"];
  tree.textContent=trees[(lv.level-1)%trees.length];
  document.getElementById('streakDays').textContent=`ç¶™ç¶šæ—¥æ•°ï¼š${streak.days}æ—¥`;

  document.getElementById('journalList').innerHTML=history.length===0?"<li>ã¾ã ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>":
    history.map(h=>`<li><strong>${h.date}</strong><br>çµæœ:${h.achieve}<br>${h.text}</li>`).join("");

  document.getElementById('mypage').classList.remove('hidden');
}

// âœ… ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
["Profile","Progress","Journal"].forEach(t=>{
  document.getElementById("tab"+t).addEventListener('click',()=>{
    ["Profile","Progress","Journal"].forEach(x=>{
      document.getElementById("tab"+x).classList.remove('active');
      document.getElementById(x.toLowerCase()+"Section").classList.add('hidden');
    });
    document.getElementById("tab"+t).classList.add('active');
    document.getElementById(t.toLowerCase()+"Section").classList.remove('hidden');
  });
});

// âœ… ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒªã‚»ãƒƒãƒˆ
document.getElementById('resetProfile').addEventListener('click', () => {
  if(confirm("æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã¾ã™ã€‚")){
    localStorage.removeItem('stepbit_profile');
    localStorage.removeItem('stepbit_level');
    localStorage.removeItem('stepbit_streak');
    localStorage.removeItem('stepbit_history');

    document.getElementById('mypage').classList.add('hidden');
    document.getElementById('onboarding').classList.remove('hidden');

    document.getElementById('name').value='';
    document.getElementById('gender').value='';
    document.getElementById('age').value='';
    document.getElementById('goalTitle').value='';
    document.querySelectorAll('.chip').forEach(c=>c.classList.remove('selected'));
  }
});

// âœ… èµ·å‹•æ™‚
window.onload=()=>{
  if(localStorage.getItem('stepbit_profile')){
    document.getElementById('onboarding').classList.add('hidden');
    document.getElementById('moodSelect').classList.remove('hidden');
  }
};
</script>
</body>
</html>
