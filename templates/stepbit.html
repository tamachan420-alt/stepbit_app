<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stepbit 完全版</title>
<style>
body { font-family:"Helvetica Neue", Arial, sans-serif; margin:20px; background:#fafafa;}
.card { background:#fff; padding:16px; border-radius:12px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:20px; }
button { padding:8px 14px; border:none; border-radius:6px; cursor:pointer; }
button.primary { background:#FF6B6B; color:#fff; }
button.secondary { background:#ccc; color:#333; }
input, select, textarea { width:100%; padding:8px; margin:6px 0; border:1px solid #ccc; border-radius:6px; }
.chip { display:inline-block; padding:6px 10px; margin:4px; border:1px solid #ccc; border-radius:12px; cursor:pointer; }
.chip.selected { background:#FF6B6B; color:#fff; }
.hidden { display:none; }
.mood-btn { margin:4px; padding:8px 14px; border:1px solid #ccc; border-radius:6px; cursor:pointer; }
.mood-btn.active { background:#FF6B6B; color:#fff; }
.tabs { display:flex; margin-bottom:10px; }
.tab { flex:1; padding:8px; text-align:center; border-bottom:2px solid #ccc; cursor:pointer; }
.tab.active { border-bottom:3px solid #FF6B6B; font-weight:bold; color:#FF6B6B; }
#journalComment { padding:10px; border-radius:6px; height:100px; color:#fff; display:flex; align-items:center; justify-content:center; text-align:center; }
</style>
</head>
<body>

<!-- 🧭 初期設定 -->
<div id="onboarding" class="card">
  <h2>初期プロフィール設定</h2>
  <label>名前</label>
  <input id="name" placeholder="例: 山田 太郎">

  <label>性別</label>
  <select id="gender">
    <option value="">選択してください</option>
    <option value="男性">男性</option>
    <option value="女性">女性</option>
    <option value="その他">その他</option>
  </select>

  <label>年齢</label>
  <input id="age" type="number" min="0" placeholder="例: 25">

  <label>性格タイプ</label>
  <div class="chips">
    <span class="chip" data-val="追い込み型">追い込み型</span>
    <span class="chip" data-val="計画型">計画型</span>
    <span class="chip" data-val="マイペース型">マイペース型</span>
  </div>

  <label>目標</label>
  <input id="goalTitle" placeholder="例: 英会話・筋トレ・読書など">

  <button id="saveOnboard" class="primary">保存して次へ</button>
</div>

<!-- 😌 今日の気分 -->
<div id="moodSelect" class="card hidden">
  <h2>今日の気分を選択してください</h2>
  <div id="moodBtns">
    <button class="mood-btn" data-level="5">元気 💪</button>
    <button class="mood-btn" data-level="4">やや元気 🙂</button>
    <button class="mood-btn" data-level="3">普通 😐</button>
    <button class="mood-btn" data-level="2">少し疲れた 😴</button>
    <button class="mood-btn" data-level="1">今日は休む 💤</button>
  </div>
  <button id="confirmMood" class="primary">チャレンジを見る</button>
</div>

<!-- 💡 今日のチャレンジ -->
<div id="challenge" class="card hidden">
  <h2>今日のチャレンジ</h2>
  <p id="challengeText"></p>
  <button class="secondary" id="btnDid">やった ✅</button>
  <button class="secondary" id="btnHalf">ややできた ⚡</button>
  <button class="secondary" id="btnFail">できなかった ❌</button>
</div>

<!-- ✏️ ジャーナル -->
<div id="journal" class="card hidden">
  <h2>今日の一歩ジャーナル</h2>
  <div style="display:flex; gap:10px;">
    <textarea id="journalText" rows="4" placeholder="今日の感想・気づきを書きましょう" style="flex:1;"></textarea>
    <div id="journalComment" style="flex:0 0 200px; border:1px solid #ccc;"></div>
  </div>
  <button id="saveJournal" class="primary">保存</button>
</div>

<!-- 👤 マイページ -->
<div id="mypage" class="card hidden">
  <div class="tabs">
    <div class="tab active" id="tabProfile">プロフィール情報</div>
    <div class="tab" id="tabProgress">達成状況</div>
    <div class="tab" id="tabJournal">ジャーナル履歴</div>
  </div>

  <!-- プロフィール情報 -->
  <div id="profileSection">
    <h3>プロフィール情報</h3>
    <div id="profileInfo"></div>
    <button id="resetProfile" class="secondary">プロフィールをリセット</button>
  </div>

  <!-- 達成状況 -->
  <div id="progressSection" class="hidden">
    <h3>達成状況</h3>
    <ul id="historyList"></ul>
  </div>

  <!-- ジャーナル履歴 -->
  <div id="journalSection" class="hidden">
    <h3>過去のジャーナル</h3>
    <ul id="journalList"></ul>
  </div>
</div>

<script>
let selectedMood = null;
let selectedAchieve = null;

// 🧩 チップ選択
document.querySelectorAll('.chip').forEach(c=>{
  c.addEventListener('click', ()=>{
    document.querySelectorAll('.chip').forEach(x=>x.classList.remove('selected'));
    c.classList.add('selected');
  });
});

// 🧩 保存ボタン（初期設定）
document.getElementById('saveOnboard').addEventListener('click',()=>{
  const profile = {
    name: document.getElementById('name').value,
    gender: document.getElementById('gender').value,
    age: document.getElementById('age').value,
    personality: Array.from(document.querySelectorAll('.chip.selected')).map(c=>c.dataset.val)[0] || "",
    goal: document.getElementById('goalTitle').value
  };
  if(!profile.name || !profile.goal){ alert("名前と目標は必須です"); return; }
  localStorage.setItem('stepbit_profile', JSON.stringify(profile));
  document.getElementById('onboarding').classList.add('hidden');
  document.getElementById('moodSelect').classList.remove('hidden');
});

// 😌 気分選択
document.querySelectorAll('.mood-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.mood-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    selectedMood = parseInt(btn.dataset.level);
  });
});

document.getElementById('confirmMood').addEventListener('click',()=>{
  if(!selectedMood){ alert("気分を選択してください"); return; }
  document.getElementById('challengeText').textContent = suggestChallenge();
  document.getElementById('moodSelect').classList.add('hidden');
  document.getElementById('challenge').classList.remove('hidden');
});

// 💡 チャレンジ提案
function suggestChallenge(){
  const p = JSON.parse(localStorage.getItem('stepbit_profile'));
  const goal = p.goal || "目標";
  const type = p.personality || "マイペース型";

  if(selectedMood <= 2) return `今日は休息日。${goal}のことを考える時間にしよう。`;
  if(goal.includes("英会話")){
    if(type==="追い込み型" && selectedMood>=4) return "英会話フレーズを10個練習してみよう！";
    if(type==="計画型") return "英会話アプリで5分リスニング練習。";
    return "英語日記を1文だけ書いてみよう！";
  }
  if(goal.includes("筋トレ")){
    if(selectedMood>=4) return "腕立て20回・スクワット30回に挑戦！";
    if(selectedMood===3) return "ストレッチ＋軽いスクワット5回！";
    return "深呼吸して体を休めよう。";
  }
  if(goal.includes("読書")){
    if(selectedMood>=4) return "本を10ページ読んで要約してみよう。";
    return "1ページでもOK！継続が大事📖";
  }
  return `${goal}に向けて、少しでも前進してみよう！`;
}

// 💪 チャレンジ結果
["btnDid","btnHalf","btnFail"].forEach(id=>{
  document.getElementById(id).addEventListener('click',()=>{
    if(id==="btnDid") selectedAchieve="やった";
    if(id==="btnHalf") selectedAchieve="ややできた";
    if(id==="btnFail") selectedAchieve="できなかった";

    const comment = document.getElementById('journalComment');
    if(selectedAchieve==="やった"){ comment.textContent="最高！よく頑張ったね🎉"; comment.style.background="#28a745"; }
    else if(selectedAchieve==="ややできた"){ comment.textContent="ナイスチャレンジ✨"; comment.style.background="#ffc107"; comment.style.color="#000"; }
    else{ comment.textContent="大丈夫！明日また一歩💪"; comment.style.background="#dc3545"; }

    document.getElementById('challenge').classList.add('hidden');
    document.getElementById('journal').classList.remove('hidden');
  });
});

// ✏️ ジャーナル保存 → マイページへ
document.getElementById('saveJournal').addEventListener('click',()=>{
  const history = JSON.parse(localStorage.getItem('stepbit_history')||'[]');
  const entry = {
    date: new Date().toLocaleString(),
    mood: selectedMood,
    achieve: selectedAchieve,
    text: document.getElementById('journalText').value
  };
  history.push(entry);
  localStorage.setItem('stepbit_history', JSON.stringify(history));
  document.getElementById('journal').classList.add('hidden');
  showMyPage();
});

// 👤 マイページ表示
function showMyPage(){
  const data = JSON.parse(localStorage.getItem('stepbit_profile'));
  const history = JSON.parse(localStorage.getItem('stepbit_history')||'[]');

  document.getElementById('profileInfo').innerHTML = `
    <p><strong>名前：</strong>${data.name}</p>
    <p><strong>性別：</strong>${data.gender||"未設定"}</p>
    <p><strong>年齢：</strong>${data.age||"未設定"}</p>
    <p><strong>性格タイプ：</strong>${data.personality||"未設定"}</p>
    <p><strong>目標：</strong>${data.goal}</p>
  `;
  document.getElementById('historyList').innerHTML = history.length===0 ? "<li>まだ履歴はありません。</li>" :
    history.map(h=>`<li>${h.date}｜${h.achieve}</li>`).join("");

  document.getElementById('journalList').innerHTML = history.length===0 ? "<li>まだジャーナルはありません。</li>" :
    history.map(h=>`<li><strong>${h.date}</strong><br>気分:${h.mood}｜結果:${h.achieve}<br>${h.text}</li>`).join("");

  document.getElementById('mypage').classList.remove('hidden');
}

// 🔁 リセット
document.getElementById('resetProfile').addEventListener('click',()=>{
  if(confirm("プロフィールをリセットして最初からやり直しますか？")){
    localStorage.clear();
    document.getElementById('mypage').classList.add('hidden');
    document.getElementById('onboarding').classList.remove('hidden');
  }
});

// 🗂️ タブ切り替え
const tabs = ["Profile","Progress","Journal"];
tabs.forEach(t=>{
  document.getElementById("tab"+t).addEventListener('click',()=>{
    tabs.forEach(x=>{
      document.getElementById("tab"+x).classList.remove('active');
      document.getElementById(x.toLowerCase()+"Section").classList.add('hidden');
    });
    document.getElementById("tab"+t).classList.add('active');
    document.getElementById(t.toLowerCase()+"Section").classList.remove('hidden');
  });
});

// 🚀 起動時
window.onload = ()=>{
  if(localStorage.getItem('stepbit_profile')){
    document.getElementById('onboarding').classList.add('hidden');
    document.getElementById('moodSelect').classList.remove('hidden');
  }
};
</script>
</body>
</html>
