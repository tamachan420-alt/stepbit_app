<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stepbit ã‚¿ãƒ–ç‰ˆãƒã‚¤ãƒšãƒ¼ã‚¸ å®Œå…¨ç‰ˆ</title>
<style>
body { font-family:"Helvetica Neue", Arial, sans-serif; margin:20px; }
nav button { margin:4px; padding:6px 12px; }
nav button.active { background:#FF6B6B;color:#fff; }
.chip { display:inline-block;padding:4px 8px;margin:2px;border:1px solid #ccc;border-radius:12px;cursor:pointer; }
.chip.selected { background:#FF6B6B;color:#fff; }
.mood-btn { margin:2px;padding:6px 12px;border:1px solid #ccc;cursor:pointer; }
.mood-btn.active { background:#FF6B6B;color:#fff; }
.card { padding:10px;border:1px solid #ddd;border-radius:8px;margin-top:10px; position:relative; }
.small { padding:4px 8px; cursor:pointer; border-radius:6px; margin-top:5px; }
textarea { width:100%; margin-top:5px; }
.achieve-btn { margin:2px; padding:4px 8px; cursor:pointer; border-radius:6px; border:1px solid #ccc; }
.achieve-btn.selected { background:#FF6B6B;color:#fff; border-color:#FF6B6B; }

/* ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚³ãƒ¡ãƒ³ãƒˆ */
#journalComment { padding:10px; border-radius:6px; height:100px; color:#fff; display:flex; align-items:center; justify-content:center; text-align:center; }

/* ã‚¿ãƒ– */
.tab-buttons { margin-bottom:10px; }
.tab-buttons button { margin-right:4px; padding:4px 10px; cursor:pointer; border-radius:6px; border:1px solid #ccc; }
.tab-buttons button.active { background:#FF6B6B;color:#fff; border-color:#FF6B6B; }
.tab-content { display:none; }
.tab-content.active { display:block; }
</style>
</head>
<body>

<nav>
  <button id="nav-mypage">ãƒã‚¤ãƒšãƒ¼ã‚¸</button>
</nav>

<!-- åˆå›è¨­å®š -->
<div id="onboarding" style="display:none" class="card">
  <h3>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç™»éŒ²ï¼ˆåˆå›ã®ã¿ï¼‰</h3>
  <input id="name" placeholder="åå‰"><br>
  <input id="gender" placeholder="æ€§åˆ¥"><br>
  <input id="age" placeholder="å¹´é½¢"><br>
  <div class="chips">
    <span class="chip" data-val="è¿½ã„è¾¼ã¿å‹">è¿½ã„è¾¼ã¿å‹</span>
    <span class="chip" data-val="è¨ˆç”»å‹">è¨ˆç”»å‹</span>
    <span class="chip" data-val="ãƒã‚¤ãƒšãƒ¼ã‚¹å‹">ãƒã‚¤ãƒšãƒ¼ã‚¹å‹</span>
  </div>
  <input id="goalTitle" placeholder="ç›®æ¨™"><br>
  <button id="saveOnboard">ä¿å­˜ã—ã¦æ¬¡ã¸</button>
</div>

<!-- ä»Šæ—¥ã®æ°—åˆ† -->
<div id="moodSelect" style="display:none" class="card">
  <h3>ä»Šæ—¥ã®æ°—åˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
  <div id="moodBtns">
    <button class="mood-btn" data-level="5">å…ƒæ°—</button>
    <button class="mood-btn" data-level="4">ã‚„ã‚„å…ƒæ°—</button>
    <button class="mood-btn" data-level="3">æ™®é€š</button>
    <button class="mood-btn" data-level="2">å°‘ã—ç–²ã‚Œã¦ã‚‹</button>
    <button class="mood-btn" data-level="1">ä»Šæ—¥ã¯ä¼‘ã‚€</button>
  </div>
  <button id="confirmMood" style="margin-top:10px;">ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’è¡¨ç¤º</button>
</div>

<!-- ä»Šæ—¥ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ -->
<div id="challenge" style="display:none" class="card">
  <h3>ä»Šæ—¥ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
  <div id="challengeText">ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
  <div id="achieveBtns" style="margin-top:5px;">
    <button class="achieve-btn" data-val="ã‚„ã£ãŸ">ã‚„ã£ãŸ âœ…</button>
    <button class="achieve-btn" data-val="ã‚„ã‚„ã§ããŸ">ã‚„ã‚„ã§ããŸ âš¡</button>
    <button class="achieve-btn" data-val="ã§ããªã‹ã£ãŸ">ã§ããªã‹ã£ãŸ âŒ</button>
  </div>
</div>

<!-- ä»Šæ—¥ã®ä¸€æ­©ã‚¸ãƒ£ãƒ¼ãƒŠãƒ« -->
<div id="journal" style="display:none" class="card">
  <h3>ä»Šæ—¥ã®ä¸€æ­©ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«</h3>
  <div style="display:flex; gap:10px;">
    <textarea id="journalAchievement" rows="4" placeholder="ä»Šæ—¥ã®é”æˆã‚„æ„Ÿæƒ³ã‚’æ›¸ãã¾ã—ã‚‡ã†" style="flex:1;"></textarea>
    <div id="journalComment" style="flex:0 0 200px; border:1px solid #ccc;"></div>
  </div>
  <button id="saveJournal" style="margin-top:10px;">ä¿å­˜</button>
</div>

<!-- ãƒã‚¤ãƒšãƒ¼ã‚¸ -->
<div id="mypage" style="display:none">
  <h3>ãƒã‚¤ãƒšãƒ¼ã‚¸</h3>
  <div class="tab-buttons">
    <button data-tab="profileTab" class="active">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</button>
    <button data-tab="achievementTab">é”æˆçŠ¶æ³</button>
  </div>
  <div id="profileTab" class="tab-content active card"></div>
  <div id="achievementTab" class="tab-content card"></div>
</div>

<script>
// ----- åˆæœŸè¨­å®š -----
const sections = ['onboarding','moodSelect','challenge','journal','mypage'];
let selectedMood = null;
let selectedAchieve = null;

function showSection(id){
  sections.forEach(s=>document.getElementById(s).style.display=(s===id)?'block':'none');
}

// ãƒãƒƒãƒ—é¸æŠ
document.querySelectorAll('.chips .chip').forEach(c=>{
  c.addEventListener('click', ()=>{
    document.querySelectorAll('.chips .chip').forEach(x=>x.classList.remove('selected'));
    c.classList.add('selected');
  });
});

// åˆå›ãƒã‚§ãƒƒã‚¯
window.addEventListener('DOMContentLoaded',()=>{
  const savedProfile = localStorage.getItem('stepbit_profile');
  if(!savedProfile) showSection('onboarding');
  else showSection('moodSelect');
  renderProfile();
  renderAchievement();
});

// ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¿å­˜
document.getElementById('saveOnboard').addEventListener('click',()=>{
  const profile = {
    name: document.getElementById('name').value,
    gender: document.getElementById('gender').value,
    age: document.getElementById('age').value,
    personality: Array.from(document.querySelectorAll('.chips .chip.selected')).map(c=>c.dataset.val),
    goal: document.getElementById('goalTitle').value
  };
  if(!profile.name||!profile.goal){alert('åå‰ã¨ç›®æ¨™ã¯å¿…é ˆ'); return;}
  localStorage.setItem('stepbit_profile',JSON.stringify(profile));
  showSection('moodSelect');
  renderProfile();
});

// æ°—åˆ†é¸æŠ
document.querySelectorAll('#moodBtns .mood-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('#moodBtns .mood-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    selectedMood = parseInt(btn.dataset.level);
  });
});
document.getElementById('confirmMood').addEventListener('click',()=>{
  if(!selectedMood){ alert('æ°—åˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; }
  document.getElementById('challengeText').innerText = suggestChallenge();
  showSection('challenge');
});

// AIãƒãƒ£ãƒ¬ãƒ³ã‚¸ææ¡ˆ
function suggestChallenge(){
  const profile = JSON.parse(localStorage.getItem('stepbit_profile')||'{}');
  const personality = profile.personality?.[0] || "ãƒã‚¤ãƒšãƒ¼ã‚¹å‹";
  const history = JSON.parse(localStorage.getItem('stepbit_history')||'[]');
  const last3 = history.slice(-3);
  const failCount = last3.filter(h=>h.achieve==="ã§ããªã‹ã£ãŸ").length;

  if(selectedMood<=2) return "ä»Šæ—¥ã¯ç„¡ç†ã›ãšä¼‘ã‚€";
  if(personality==="è¿½ã„è¾¼ã¿å‹"){ if(selectedMood>=4) return "å‹é”ã¨ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§è‹±ä¼šè©±ãƒãƒ£ãƒ¬ãƒ³ã‚¸"; if(selectedMood===3) return "è‹±ä¼šè©±ãƒ•ãƒ¬ãƒ¼ã‚º5ã¤æŒ‘æˆ¦"; }
  if(personality==="è¨ˆç”»å‹"){ if(selectedMood>=4){ return failCount===0?"è‹±ä¼šè©±ãƒ•ãƒ¬ãƒ¼ã‚º3ã¤æŒ‘æˆ¦":"è»½ã‚ã«èª¿æ•´"; } if(selectedMood===3) return "èª­æ›¸ã‚„æ•£æ­©ã§ãƒªãƒ©ãƒƒã‚¯ã‚¹"; }
  if(personality==="ãƒã‚¤ãƒšãƒ¼ã‚¹å‹"){ if(selectedMood>=4) return "è‹±ä¼šè©±ãƒ•ãƒ¬ãƒ¼ã‚º3ã¤æŒ‘æˆ¦"; if(selectedMood===3) return "æ•£æ­©ã‚„ã‚¹ãƒˆãƒ¬ãƒƒãƒã§ãƒªãƒ©ãƒƒã‚¯ã‚¹"; }
  return "è»½ãã‚¹ãƒˆãƒ¬ãƒƒãƒã—ã¦ä¼‘ã‚€";
}

// é”æˆåº¦é¸æŠï¼†ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤º
document.querySelectorAll('#achieveBtns .achieve-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('#achieveBtns .achieve-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedAchieve = btn.dataset.val;
    const stepText = document.getElementById('challengeText').innerText;
    const history = JSON.parse(localStorage.getItem('stepbit_history')||'[]');
    history.push({step:stepText,date:new Date().toISOString(),achieve:selectedAchieve});
    localStorage.setItem('stepbit_history',JSON.stringify(history));

    // ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«æ¨ªã‚³ãƒ¡ãƒ³ãƒˆ
    const journalComment = document.getElementById('journalComment');
    if(selectedAchieve==="ã‚„ã£ãŸ"){ journalComment.textContent="ãŠã‚ã§ã¨ã†ï¼ã‚ˆãã§ãã¾ã—ãŸğŸ‰"; journalComment.style.background="#28a745"; }
    else if(selectedAchieve==="ã‚„ã‚„ã§ããŸ"){ journalComment.textContent="ã„ã„æ„Ÿã˜ï¼å°‘ã—ãšã¤æ…£ã‚Œã¦ã„ã“ã†âœ¨"; journalComment.style.background="#ffc107"; journalComment.style.color="#000"; }
    else{ journalComment.textContent="å¤§ä¸ˆå¤«ï¼æ¬¡ã¯ã§ãã‚‹ï¼ğŸ’ª"; journalComment.style.background="#dc3545"; }

    document.getElementById('journalAchievement').value = `${stepText} - ${selectedAchieve}`;
    showSection('journal');
  });
});

// ã‚¸ãƒ£ãƒ¼ãƒŠãƒ«ä¿å­˜ï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸é·ç§»ï¼‰
document.getElementById('saveJournal').addEventListener('click',()=>{
  showSection('mypage');
  renderProfile();
  renderAchievement();
});

// ----- ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚¿ãƒ– -----
document.querySelectorAll('.tab-buttons button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.tab-buttons button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
    document.getElementById(btn.dataset.tab).classList.add('active');
  });
});

// ----- ãƒã‚¤ãƒšãƒ¼ã‚¸è¡¨ç¤º -----
function renderProfile(){
  const container = document.getElementById('profileTab');
  const data = JSON.parse(localStorage.getItem('stepbit_profile')||'{}');
  container.innerHTML=`
    <h4>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±</h4>
    <p>åå‰: ${data.name||''}</p>
    <p>æ€§åˆ¥: ${data.gender||''}</p>
    <p>å¹´é½¢: ${data.age||''}</p>
    <p>æ€§æ ¼: ${data.personality?.[0]||''}</p>
    <p>ç›®æ¨™: ${data.goal||''}</p>
  `;
}

function renderAchievement(){
  const container = document.getElementById('achievementTab');
  const history = JSON.parse(localStorage.getItem('stepbit_history')||'[]');
  container.innerHTML=`
    <h4>é”æˆçŠ¶æ³</h4>
    <p>é€£ç¶šé”æˆæ—¥æ•°: <span id="streak">0</span>æ—¥</p>
    <ul id="historyList"></ul>
  `;
  const list = container.querySelector('#historyList');
  if(history.length===0) list.innerHTML='<li>ã¾ã å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</li>';
  else history.forEach(h=>{
    const li = document.createElement('li');
    const d = new Date(h.date);
    li.textContent = `${d.toLocaleDateString()} ${d.toLocaleTimeString()} - ${h.step} (${h.achieve})`;
    list.appendChild(li);
  });

  const today = new Date();
  let streak = 0;
  const sorted = history.slice().sort((a,b)=>new Date(b.date)-new Date(a.date));
  for(let i=0;i<sorted.length;i++){
    const d = new Date(sorted[i].date);
    const diffDays = Math.floor((today-d)/(1000*60*60*24));
    if(diffDays===streak) streak++; else break;
  }
  container.querySelector('#streak').innerText = streak;
}

// ãƒã‚¤ãƒšãƒ¼ã‚¸ãƒœã‚¿ãƒ³
document.getElementById('nav-mypage').addEventListener('click', ()=>{
  showSection('mypage');
  renderProfile();
  renderAchievement();
});
</script>
</body>
</html>
